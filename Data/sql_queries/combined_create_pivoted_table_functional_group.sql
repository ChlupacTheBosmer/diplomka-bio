CREATE TABLE visits_pivot_functional_group AS
SELECT
    COALESCE(sp_code, 'unknown') AS sp_code,
    season,
    elevation,
	COALESCE(species, 'unknown') AS species,
    SUM(CASE WHEN functional_group = 'Unknown' THEN freq_fm_spp ELSE 0 END) AS unknown,
    SUM(CASE WHEN functional_group = 'Acariformes' THEN freq_fm_spp ELSE 0 END) AS acariformes,
    SUM(CASE WHEN functional_group = 'Annelida' THEN freq_fm_spp ELSE 0 END) AS annelida,
    SUM(CASE WHEN functional_group = 'Ant' THEN freq_fm_spp ELSE 0 END) AS ant,
    SUM(CASE WHEN functional_group = 'Araneae' THEN freq_fm_spp ELSE 0 END) AS araneae,
    SUM(CASE WHEN functional_group = 'Archaeognatha' THEN freq_fm_spp ELSE 0 END) AS archaeognatha,
    SUM(CASE WHEN functional_group = 'Bee' THEN freq_fm_spp ELSE 0 END) AS bee,
    SUM(CASE WHEN functional_group = 'Blattodea' THEN freq_fm_spp ELSE 0 END) AS blattodea,
    SUM(CASE WHEN functional_group = 'Butterfly' THEN freq_fm_spp ELSE 0 END) AS butterfly,
    SUM(CASE WHEN functional_group = 'Carpenters' THEN freq_fm_spp ELSE 0 END) AS carpenters,
    SUM(CASE WHEN functional_group = 'Chilopoda' THEN freq_fm_spp ELSE 0 END) AS chilopoda,
    SUM(CASE WHEN functional_group = 'Chiroptera' THEN freq_fm_spp ELSE 0 END) AS chiroptera,
    SUM(CASE WHEN functional_group = 'Coleoptera' THEN freq_fm_spp ELSE 0 END) AS coleoptera,
    SUM(CASE WHEN functional_group = 'Collembola' THEN freq_fm_spp ELSE 0 END) AS collembola,
    SUM(CASE WHEN functional_group = 'Dermaptera' THEN freq_fm_spp ELSE 0 END) AS dermaptera,
    SUM(CASE WHEN functional_group = 'Eusocial Bee' THEN freq_fm_spp ELSE 0 END) AS eusocial_bee,
    SUM(CASE WHEN functional_group = 'Gastropoda' THEN freq_fm_spp ELSE 0 END) AS gastropoda,
    SUM(CASE WHEN functional_group = 'Haplotaxida' THEN freq_fm_spp ELSE 0 END) AS haplotaxida,
    SUM(CASE WHEN functional_group = 'Hemiptera' THEN freq_fm_spp ELSE 0 END) AS hemiptera,
    SUM(CASE WHEN functional_group = 'Hirudinea' THEN freq_fm_spp ELSE 0 END) AS hirudinea,
    SUM(CASE WHEN functional_group = 'Hoverfly' THEN freq_fm_spp ELSE 0 END) AS hoverfly,
    SUM(CASE WHEN functional_group = 'Isopoda' THEN freq_fm_spp ELSE 0 END) AS isopoda,
    SUM(CASE WHEN functional_group = 'Lepidoptera larva' THEN freq_fm_spp ELSE 0 END) AS lepidoptera_larva,
    SUM(CASE WHEN functional_group = 'Moth' THEN freq_fm_spp ELSE 0 END) AS moth,
    SUM(CASE WHEN functional_group = 'Myriapoda' THEN freq_fm_spp ELSE 0 END) AS myriapoda,
    SUM(CASE WHEN functional_group = 'Neuroptera' THEN freq_fm_spp ELSE 0 END) AS neuroptera,
    SUM(CASE WHEN functional_group = 'Opiliones' THEN freq_fm_spp ELSE 0 END) AS opiliones,
    SUM(CASE WHEN functional_group = 'Orthoptera' THEN freq_fm_spp ELSE 0 END) AS orthoptera,
    SUM(CASE WHEN functional_group = 'Passeriformes' THEN freq_fm_spp ELSE 0 END) AS passeriformes,
    SUM(CASE WHEN functional_group = 'Phasmatodea' THEN freq_fm_spp ELSE 0 END) AS phasmatodea,
    SUM(CASE WHEN functional_group = 'Phthiraptera' THEN freq_fm_spp ELSE 0 END) AS phthiraptera,
    SUM(CASE WHEN functional_group = 'Psocoptera' THEN freq_fm_spp ELSE 0 END) AS psocoptera,
    SUM(CASE WHEN functional_group = 'Scincidae' THEN freq_fm_spp ELSE 0 END) AS scincidae,
    SUM(CASE WHEN functional_group = 'Small_Mammals' THEN freq_fm_spp ELSE 0 END) AS small_mammals,
    SUM(CASE WHEN functional_group = 'Sphingid' THEN freq_fm_spp ELSE 0 END) AS sphingid,
    SUM(CASE WHEN functional_group = 'Thysanoptera' THEN freq_fm_spp ELSE 0 END) AS thysanoptera,
    SUM(CASE WHEN functional_group = 'Trichoptera' THEN freq_fm_spp ELSE 0 END) AS trichoptera,
    SUM(CASE WHEN functional_group = 'Unsp fly' THEN freq_fm_spp ELSE 0 END) AS unsp_fly,
    SUM(CASE WHEN functional_group = 'Unsp hymenoptera' THEN freq_fm_spp ELSE 0 END) AS unsp_hymenoptera,
    SUM(CASE WHEN functional_group = 'Wasp' THEN freq_fm_spp ELSE 0 END) AS wasp,
    SUM(freq_fm_spp) AS total_visits
FROM combined
-- WHERE
-- 	include_in_network == 1
GROUP BY sp_code, season, elevation;
